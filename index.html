<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸</title>   
    <link rel="stylesheet" href="test.css">
    <style>
        table { border-collapse: collapse; }
        th, td { border: 1px solid #999; width: 32px; height: 32px; text-align: center; }
        select { font-size: 1em; }
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        .arrow-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            padding: 0 20px;
            user-select: none;
        }
        .calendar-title {
            font-size: 1.2em;
            min-width: 120px;
            text-align: center;
        }
        /* å³ä¸‹ã®ï¼‹ãƒœã‚¿ãƒ³ */
        .plus-btn {
            position: fixed;
            right: 30px;
            bottom: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #ffffff;
            color: #000000;
            font-size: 2.5em;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            z-index: 100;
            transition: background 0.2s;
        }
        .plus-btn:hover {
            background: #388E3C;
        }

        /* å·¦ä¸‹ã®ãƒ¡ãƒ¢ãƒœã‚¿ãƒ³ */
        .memo-btn {
            position: fixed;
            left: 30px;
            bottom: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #ffffff;
            color: #000000;
            font-size: 2.5em;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            z-index: 100;
            transition: background 0.2s;
        }
        .memo-btn:hover {
            background: #1976D2;
        }

        /* æ­¯è»Šãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šå›ºå®šï¼‰ */
        .setting-btn {
            position: fixed;
            right: 100px;
            top: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #787272;
            color: #fff;
            font-size: 2.5em;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            z-index: 100;
            transition: background 0.2s;
        }
        .setting-btn:hover {
            background: #787272;
        }
    </style>
</head>
<body>
    <h1>åé ­ç—›è¨˜éŒ²</h1>

    <div class="calendar-header">
        <button class="arrow-btn" id="prevMonthBtn">&#8592;</button>
        <span class="calendar-title" id="calendarTitle"></span>
        <button class="arrow-btn" id="nextMonthBtn">&#8594;</button>
    </div>
    <div id="calendar"></div>

    <!-- å³ä¸‹ã®ï¼‹ãƒœã‚¿ãƒ³ -->
    <a href="write.html" class="plus-btn" title="æ–°è¦ä½œæˆ">ï¼‹</a>

    <!-- å·¦ä¸‹ã®ãƒ¡ãƒ¢ãƒœã‚¿ãƒ³ -->
    <a href="memo.html" class="memo-btn" title="ãƒ¡ãƒ¢ãƒšãƒ¼ã‚¸">ğŸ“</a>

    <!-- æ­¯è»Šãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šå›ºå®šï¼‰ -->
    <a href="setting.html" class="setting-btn" title="è¨­å®š">
        <span style="font-size:2em;">&#9881;</span>
    </a>
  
    <script>
    window.addEventListener('DOMContentLoaded', () => {
        // ã“ã“ã«å…¨ã¦ã®åˆæœŸåŒ–ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»å‡¦ç†ã‚’æ›¸ã
        let currentYear, currentMonth;
        const calendarDiv = document.getElementById('calendar');
        const calendarTitle = document.getElementById('calendarTitle');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');

        function updateCalendarTitle(year, month) {
            calendarTitle.textContent = `${year}å¹´ ${month}æœˆ`;
        }

        async function createCalendar(year, month) {
            updateCalendarTitle(year, month);
            const firstDay = new Date(year, month - 1, 1).getDay();
            const lastDate = new Date(year, month, 0).getDate();

            // â‘  Firestoreã‹ã‚‰å½“æœˆã®ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ã‚’å–å¾—
            const start = `${year}-${String(month).padStart(2, '0')}-01`;
            const end = `${year}-${String(month).padStart(2, '0')}-31`;
            const snapshot = await db.collection('records')
                .where(firebase.firestore.FieldPath.documentId(), '>=', start)
                .where(firebase.firestore.FieldPath.documentId(), '<=', end)
                .get();
            const recordDates = snapshot.docs.map(doc => doc.id);

            let html = '<table><thead><tr>';
            const week = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
            for(let d of week) html += `<th>${d}</th>`;
            html += '</tr></thead><tbody><tr>';

            for(let i = 0; i < firstDay; i++) html += '<td></td>';
            for(let date = 1; date <= lastDate; date++) {
                if((firstDay + date - 1) % 7 === 0 && date !== 1) html += '</tr><tr>';
                const ymd = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥ä»˜ã«ã¯ã‚¯ãƒ©ã‚¹ã®ã¿è¿½åŠ ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ãªã—ï¼‰
                const hasRecord = recordDates.includes(ymd);
                html += `<td>
                    <a href="#" class="calendar-link${hasRecord ? ' has-record' : ''}" data-date="${ymd}">
                        ${date}
                    </a>
                </td>`;
            }
            const remaining = (firstDay + lastDate) % 7;
            if(remaining !== 0) for(let i = 0; i < 7 - remaining; i++) html += '<td></td>';
            html += '</tr></tbody></table>';
            calendarDiv.innerHTML = html;

            // æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ—¢å­˜å‡¦ç†ï¼‰
            document.querySelectorAll('.calendar-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const date = this.getAttribute('data-date');
                    window.location.href = `write.html?date=${date}`;
                });
            });
        }

        function showCalendar(year, month) {
            currentYear = year;
            currentMonth = month;
            createCalendar(year, month);
        }

        prevMonthBtn.addEventListener('click', () => {
            let year = currentYear;
            let month = currentMonth - 1;
            if(month < 1) {
                month = 12;
                year--;
            }
            showCalendar(year, month);
        });

        nextMonthBtn.addEventListener('click', () => {
            let year = currentYear;
            let month = currentMonth + 1;
            if(month > 12) {
                month = 1;
                year++;
            }
            showCalendar(year, month);
        });

        // åˆæœŸè¡¨ç¤º
        const now = new Date();
        showCalendar(now.getFullYear(), now.getMonth() + 1);

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ã§Firestoreã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†è¡¨ç¤º
        calendarDiv.addEventListener('click', (e) => {
          if (e.target.classList.contains('calendar-link')) {
            e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒªãƒ³ã‚¯é·ç§»ã‚’é˜²æ­¢
            const selectedDate = e.target.dataset.date;
            // Firestoreã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            db.collection('records').doc(selectedDate).get()
              .then((doc) => {
                if (doc.exists) {
                  const data = doc.data();
                  displayRecord(data); // ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
                } else {
                  alert('ã“ã®æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
                }
              })
              .catch((error) => {
                console.error('Error getting document: ', error);
                alert('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
              });
          }
        });

        // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayRecord(data) {
          const display = document.getElementById('recordDisplay');
          display.innerHTML = `
            <div style="border:1px solid #888; background:#fff; padding:12px; margin:12px 0;">
              <h3>è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿</h3>
              <ul>
                <li>æ—¥ä»˜: ${data.date || ''}</li>
                <li>ãƒ¡ãƒ¢: ${data.memo || ''}</li>
                <!-- ä»–ã®é …ç›®ã‚‚åŒæ§˜ã« -->
              </ul>
            </div>
          `;
        }
    });
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore-compat.js"></script>
<script>
  // Firebaseã®è¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyBHlw82RbUfenDnDyM5WOnrEJqHHYwqQS4",
    authDomain: "headachereporttest.firebaseapp.com",
    projectId: "headachereporttest",
    storageBucket: "headachereporttest.appspot.com",
    messagingSenderId: "1011198068393",
    appId: "1:1011198068393:web:fa25a80f678c78f1764bb8",
    measurementId: "YOUR_MEASUREMENT_ID"  // Google Analytics ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆ
  };

  // Firebaseã‚’åˆæœŸåŒ–
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore(); // Firestoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾— <!-- æ›´æ–°ã‹ã‘ã‚‹ã‚ˆã†ã‚³ãƒ¡ -->
</script>
</body>
</html>